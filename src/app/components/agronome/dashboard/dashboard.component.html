<div class="agronome-dashboard">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-left">
      <h1>ğŸ”¬ SmartCow - Espace Agronome</h1>
      <p class="subtitle">Analyse et Supervision VÃ©tÃ©rinaire</p>
    </div>
    <div class="user-menu">
      <span class="user-name">{{ (authService.currentUser | async)?.full_name }}</span>
      <span class="user-role">Agronome</span>
      <button (click)="logout()" class="btn-logout">DÃ©connexion</button>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="dashboard-nav">
    <a routerLink="/agronome/dashboard" routerLinkActive="active">
      ğŸ“Š Tableau de bord
    </a>
    <a routerLink="/agronome/analytics" routerLinkActive="active">
      ğŸ“ˆ Analyses
    </a>
    <a routerLink="/agronome/cows" routerLinkActive="active">
      ğŸ„ Troupeau
    </a>
    <a routerLink="/agronome/alerts" routerLinkActive="active">
      ğŸš¨ Alertes
    </a>
    <a routerLink="/agronome/predictions" routerLinkActive="active">
      ğŸ¤– PrÃ©dictions AI
    </a>
    <a routerLink="/agronome/reports" routerLinkActive="active">
      ğŸ“„ Rapports
    </a>
  </nav>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des donnÃ©es analytiques...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">

    <!-- KPI Cards -->
    <div class="kpi-grid">
      <!-- Total Vaches -->
      <div class="kpi-card">
        <div class="kpi-icon">ğŸ„</div>
        <div class="kpi-content">
          <h3>{{ stats.totalCows }}</h3>
          <p>Total Vaches</p>
          <span class="kpi-detail">{{ stats.activeCows }} actives</span>
        </div>
      </div>

      <!-- SantÃ© du Troupeau -->
      <div class="kpi-card good">
        <div class="kpi-icon">â¤ï¸</div>
        <div class="kpi-content">
          <h3>{{ stats.healthyPercentage }}%</h3>
          <p>Vaches en Bonne SantÃ©</p>
          <span class="kpi-detail">Score â‰¥ 80/100</span>
        </div>
      </div>

      <!-- Vaches Ã  Risque -->
      <div class="kpi-card" [class.critical]="stats.atRiskPercentage > 10">
        <div class="kpi-icon">âš ï¸</div>
        <div class="kpi-content">
          <h3>{{ stats.atRiskPercentage }}%</h3>
          <p>Vaches Ã  Risque</p>
          <span class="kpi-detail">Score < 60/100</span>
        </div>
      </div>

      <!-- Alertes Critiques -->
      <div class="kpi-card critical">
        <div class="kpi-icon">ğŸš¨</div>
        <div class="kpi-content">
          <h3>{{ stats.criticalAlerts }}</h3>
          <p>Alertes Critiques</p>
          <span class="kpi-detail">{{ stats.warningAlerts }} warnings</span>
        </div>
      </div>

      <!-- TempÃ©rature Moyenne -->
      <div class="kpi-card">
        <div class="kpi-icon">ğŸŒ¡ï¸</div>
        <div class="kpi-content">
          <h3>{{ stats.avgTemperature }}Â°C</h3>
          <p>TempÃ©rature Moyenne</p>
          <span class="kpi-detail">Normal: 37.5-39.5Â°C</span>
        </div>
      </div>

      <!-- Rythme Cardiaque Moyen -->
      <div class="kpi-card">
        <div class="kpi-icon">ğŸ’“</div>
        <div class="kpi-content">
          <h3>{{ stats.avgHeartRate }}</h3>
          <p>Rythme Cardiaque Moy.</p>
          <span class="kpi-detail">Normal: 50-100 bpm</span>
        </div>
      </div>

      <!-- ActivitÃ© Moyenne -->
      <div class="kpi-card">
        <div class="kpi-icon">ğŸƒ</div>
        <div class="kpi-content">
          <h3>{{ stats.avgActivity }}%</h3>
          <p>ActivitÃ© Moyenne</p>
          <span class="kpi-detail">Troupeau actif</span>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="kpi-card info">
        <div class="kpi-icon">ğŸ“Š</div>
        <div class="kpi-content">
          <h3>{{ stats.totalCows * 24 }}</h3>
          <p>Mesures/Jour</p>
          <span class="kpi-detail">Monitoring continu</span>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="content-grid">

      <!-- Vaches Critiques -->
      <div class="card priority">
        <div class="card-header">
          <h2>ğŸš¨ Vaches NÃ©cessitant Attention ImmÃ©diate</h2>
          <span class="badge critical">{{ criticalCows.length }}</span>
        </div>
        <div class="card-body">
          <div *ngIf="criticalCows.length === 0" class="empty-state">
            <p>âœ… Aucune vache critique</p>
          </div>
          <div *ngFor="let cow of criticalCows" class="cow-critical-item">
            <div class="cow-header">
              <div class="cow-info">
                <h3>{{ cow.name }}</h3>
                <p>{{ cow.tag_id }} â€¢ {{ cow.breed }}</p>
              </div>
              <span [class]="getHealthClass(cow.health_score)" class="health-badge">
                {{ cow.health_score }}%
              </span>
            </div>
            <div class="cow-details">
              <span class="detail">ğŸ“ Localisation disponible</span>
              <span class="detail">â° DerniÃ¨re mesure: Il y a 5 min</span>
            </div>
            <div class="cow-actions">
              <button [routerLink]="['/agronome/cows', cow.id]" class="btn-analyze">
                ğŸ“Š Analyser
              </button>
              <button class="btn-protocol">
                ğŸ’Š Protocole
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Alertes Actives Prioritaires -->
      <div class="card">
        <div class="card-header">
          <h2>ğŸ”” Alertes Prioritaires</h2>
          <div class="filters">
            <span class="filter-badge critical">{{ stats.criticalAlerts }} Critiques</span>
            <span class="filter-badge warning">{{ stats.warningAlerts }} Warnings</span>
          </div>
        </div>
        <div class="card-body">
          <div *ngFor="let alert of alerts.slice(0, 8)" class="alert-item">
            <div class="alert-header">
              <span [class]="getSeverityClass(alert.severity)" class="severity-badge">
                {{ alert.severity }}
              </span>
              <span class="alert-type">{{ alert.type }}</span>
              <span [class]="getStatusClass(alert.status)" class="status-badge">
                {{ alert.status }}
              </span>
            </div>
            <p class="alert-message">{{ alert.message }}</p>
            <div class="alert-meta">
              <span>ğŸ„ Vache #{{ alert.cow_id }}</span>
              <span>ğŸ• {{ alert.created_at | date: 'short' }}</span>
            </div>
            <div class="alert-actions" *ngIf="alert.status === 'NEW'">
              <button class="btn-small">âœ… ReconnaÃ®tre</button>
              <button class="btn-small primary">ğŸ”§ Traiter</button>
            </div>
          </div>
          <a routerLink="/agronome/alerts" class="view-all-link">
            Voir toutes les alertes â†’
          </a>
        </div>
      </div>

      <!-- Analyse Rapide -->
      <div class="card">
        <div class="card-header">
          <h2>ğŸ“ˆ Analyse Rapide - 24h</h2>
        </div>
        <div class="card-body">
          <div class="quick-stats">
            <div class="stat-row">
              <span class="stat-label">ğŸŒ¡ï¸ TempÃ©rature</span>
              <div class="stat-bar">
                <div class="stat-fill" [style.width]="'75%'"></div>
              </div>
              <span class="stat-value">{{ stats.avgTemperature }}Â°C</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">ğŸ’“ Rythme Cardiaque</span>
              <div class="stat-bar">
                <div class="stat-fill" [style.width]="'68%'"></div>
              </div>
              <span class="stat-value">{{ stats.avgHeartRate }} bpm</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">ğŸƒ ActivitÃ©</span>
              <div class="stat-bar">
                <div class="stat-fill" [style.width]="stats.avgActivity + '%'"></div>
              </div>
              <span class="stat-value">{{ stats.avgActivity }}%</span>
            </div>
          </div>
          <button routerLink="/agronome/analytics" class="btn-full">
            ğŸ“Š Analyses DÃ©taillÃ©es
          </button>
        </div>
      </div>

      <!-- PrÃ©dictions AI -->
      <div class="card">
        <div class="card-header">
          <h2>ğŸ¤– PrÃ©dictions Intelligence Artificielle</h2>
          <span class="badge ai">Beta</span>
        </div>
        <div class="card-body">
          <div class="prediction-item">
            <div class="prediction-icon risk-high">âš ï¸</div>
            <div class="prediction-content">
              <h4>Risque Sanitaire - Vache #5</h4>
              <p>Risque Ã©levÃ© de problÃ¨me de santÃ© dans 48-72h</p>
              <span class="confidence">Confiance: 85%</span>
            </div>
          </div>
          <div class="prediction-item">
            <div class="prediction-icon risk-medium">ğŸ”¥</div>
            <div class="prediction-content">
              <h4>PÃ©riode de Chaleur - Vache #12</h4>
              <p>Chaleur prÃ©vue dans 3-5 jours</p>
              <span class="confidence">Confiance: 78%</span>
            </div>
          </div>
          <div class="prediction-item">
            <div class="prediction-icon risk-low">ğŸ¤°</div>
            <div class="prediction-content">
              <h4>VÃªlage - Vache #8</h4>
              <p>VÃªlage prÃ©vu dans 15 jours</p>
              <span class="confidence">Confiance: 92%</span>
            </div>
          </div>
          <button routerLink="/agronome/predictions" class="btn-full">
            ğŸ¤– Toutes les PrÃ©dictions
          </button>
        </div>
      </div>

      <!-- Actions Rapides -->
      <div class="card actions">
        <div class="card-header">
          <h2>âš¡ Actions Rapides</h2>
        </div>
        <div class="card-body">
          <button routerLink="/agronome/reports" class="action-btn">
            ğŸ“„ GÃ©nÃ©rer Rapport Quotidien
          </button>
          <button routerLink="/agronome/analytics" class="action-btn">
            ğŸ“Š Analyse Comparative
          </button>
          <button class="action-btn">
            ğŸ’Š CrÃ©er Protocole Traitement
          </button>
          <button routerLink="/agronome/cows" class="action-btn">
            ğŸ„ Vue d'Ensemble Troupeau
          </button>
          <button class="action-btn">
            ğŸ“§ Envoyer Recommandations
          </button>
        </div>
      </div>

      <!-- Performances Hebdomadaires -->
      <div class="card">
        <div class="card-header">
          <h2>ğŸ“Š Performance Hebdomadaire</h2>
        </div>
        <div class="card-body">
          <div class="performance-grid">
            <div class="perf-item">
              <span class="perf-label">Alertes RÃ©solues</span>
              <span class="perf-value good">28/32</span>
              <span class="perf-percent">87%</span>
            </div>
            <div class="perf-item">
              <span class="perf-label">Temps RÃ©ponse Moy.</span>
              <span class="perf-value">2.5h</span>
              <span class="perf-trend up">-15%</span>
            </div>
            <div class="perf-item">
              <span class="perf-label">Taux RÃ©cupÃ©ration</span>
              <span class="perf-value good">95%</span>
              <span class="perf-trend up">+3%</span>
            </div>
            <div class="perf-item">
              <span class="perf-label">Interventions</span>
              <span class="perf-value">12</span>
              <span class="perf-trend">stable</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
