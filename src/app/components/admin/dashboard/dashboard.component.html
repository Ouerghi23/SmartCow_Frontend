<div class="admin-dashboard">
  <!-- Header avec thÃ¨me ferme -->
  <header class="dashboard-header">
    <div class="header-left">
      <div class="logo">
        <span class="logo-icon">ğŸŒ¾</span>
        <div class="logo-text">
          <h1>SmartCow Farm</h1>
          <p class="subtitle">Gestion Intelligente du Troupeau</p>
        </div>
      </div>
    </div>
    <div class="user-menu">
      <div class="user-info">
        <span class="user-role">ğŸ‘¨â€ğŸ’¼ Administrateur</span>
        <span class="user-name">{{ (authService.currentUser | async)?.full_name || 'Admin' }}</span>
      </div>
      <button (click)="logout()" class="btn-logout">
        ğŸšª DÃ©connexion
      </button>
    </div>
  </header>

  <!-- Navigation moderne -->
  <nav class="dashboard-nav">
    <a routerLink="/admin/dashboard" routerLinkActive="active" class="nav-item">
      <span class="nav-icon">ğŸ“Š</span>
      <span class="nav-text">Tableau de bord</span>
    </a>
    <a routerLink="/admin/cows" routerLinkActive="active" class="nav-item">
      <span class="nav-icon">ğŸ„</span>
      <span class="nav-text">Troupeau</span>
    </a>
    <a routerLink="/admin/alerts" routerLinkActive="active" class="nav-item">
      <span class="nav-icon">ğŸš¨</span>
      <span class="nav-text">Alertes</span>
    </a>
    <a routerLink="/admin/users" routerLinkActive="active" class="nav-item">
      <span class="nav-icon">ğŸ‘¥</span>
      <span class="nav-text">Utilisateurs</span>
    </a>
    <a routerLink="/admin/reports" routerLinkActive="active" class="nav-item">
      <span class="nav-icon">ğŸ“ˆ</span>
      <span class="nav-text">Rapports</span>
    </a>
  </nav>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>ğŸŒ¾ Chargement des donnÃ©es de la ferme...</p>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">

    <!-- Stats Cards - ThÃ¨me Ferme -->
    <div class="stats-grid">

      <!-- Total Vaches -->
      <div class="stat-card green">
        <div class="stat-header">
          <div class="stat-icon-container">
            <span class="stat-icon">ğŸ„</span>
          </div>
          <span class="stat-trend up">+2 cette semaine</span>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.totalCows }}</h3>
          <p class="stat-label">Total Vaches</p>
          <div class="stat-footer">
            <span class="stat-detail">{{ stats.activeCows }} actives</span>
          </div>
        </div>
      </div>

      <!-- Vaches Actives -->
      <div class="stat-card blue">
        <div class="stat-header">
          <div class="stat-icon-container">
            <span class="stat-icon">âœ…</span>
          </div>
          <span class="stat-trend stable">Stable</span>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.activeCows }}</h3>
          <p class="stat-label">Vaches Actives</p>
          <div class="stat-footer">
            <span class="stat-detail">{{ ((stats.activeCows / stats.totalCows) * 100) | number:'1.0-0' }}% du troupeau</span>
          </div>
        </div>
      </div>

      <!-- Alertes Critiques -->
      <div class="stat-card red">
        <div class="stat-header">
          <div class="stat-icon-container pulse">
            <span class="stat-icon">ğŸš¨</span>
          </div>
          <span class="stat-trend" [class.down]="stats.criticalAlerts > 0">
            {{ stats.criticalAlerts > 0 ? 'Action requise' : 'Tout va bien' }}
          </span>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.criticalAlerts }}</h3>
          <p class="stat-label">Alertes Critiques</p>
          <div class="stat-footer">
            <span class="stat-detail">{{ stats.totalAlerts }} alertes totales</span>
          </div>
        </div>
      </div>

      <!-- SantÃ© du Troupeau -->
      <div class="stat-card yellow">
        <div class="stat-header">
          <div class="stat-icon-container">
            <span class="stat-icon">â¤ï¸</span>
          </div>
          <span class="stat-trend up">Excellent</span>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">95%</h3>
          <p class="stat-label">SantÃ© Moyenne</p>
          <div class="stat-footer">
            <span class="stat-detail">Score global du troupeau</span>
          </div>
        </div>
      </div>

    </div>

    <!-- Main Content Grid -->
    <div class="content-grid">

      <!-- Alertes RÃ©centes -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-icon">ğŸš¨</span>
            <h2>Alertes RÃ©centes</h2>
          </div>
          <a routerLink="/admin/alerts" class="view-all-btn">
            Voir tout <span class="arrow">â†’</span>
          </a>
        </div>
        <div class="card-body">
          <div *ngIf="recentAlerts.length === 0" class="empty-state">
            <div class="empty-icon">âœ…</div>
            <p>Aucune alerte active</p>
            <small>Votre troupeau est en bonne santÃ©</small>
          </div>

          <div *ngFor="let alert of recentAlerts" class="alert-item"
               [class.critical]="alert.severity === 'CRITICAL'"
               [class.warning]="alert.severity === 'WARNING'">
            <div class="alert-icon-wrapper">
              <span class="alert-icon">
                {{ alert.severity === 'CRITICAL' ? 'ğŸ”´' : alert.severity === 'WARNING' ? 'ğŸŸ ' : 'ğŸ”µ' }}
              </span>
            </div>
            <div class="alert-content">
              <div class="alert-top">
                <div class="alert-badges">
                  <span [class]="getSeverityClass(alert.severity)" class="badge">
                    {{ alert.severity }}
                  </span>
                  <span [class]="getStatusClass(alert.status)" class="badge">
                    {{ alert.status }}
                  </span>
                </div>
                <span class="alert-time">{{ alert.created_at | date: 'short' }}</span>
              </div>
              <p class="alert-message">{{ alert.message }}</p>
              <div class="alert-footer">
                <span class="alert-cow">ğŸ„ Vache #{{ alert.cow_id }}</span>
                <button class="btn-small">Traiter</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Vaches RÃ©centes -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-icon">ğŸ„</span>
            <h2>Troupeau RÃ©cent</h2>
          </div>
          <a routerLink="/admin/cows" class="view-all-btn">
            Voir tout <span class="arrow">â†’</span>
          </a>
        </div>
        <div class="card-body">
          <div *ngFor="let cow of recentCows" class="cow-item">
            <div class="cow-avatar">
              <span class="cow-emoji">ğŸ„</span>
            </div>
            <div class="cow-info">
              <h3 class="cow-name">{{ cow.name }}</h3>
              <p class="cow-details">
                <span class="cow-breed">{{ cow.breed }}</span>
                <span class="separator">â€¢</span>
                <span class="cow-tag">Tag: {{ cow.tag_id }}</span>
              </p>
            </div>
            <div class="cow-stats">
              <div class="health-indicator"
                   [class.excellent]="cow.health_score >= 80"
                   [class.good]="cow.health_score >= 60 && cow.health_score < 80"
                   [class.warning]="cow.health_score < 60">
                <span class="health-icon">â¤ï¸</span>
                <span class="health-value">{{ cow.health_score }}%</span>
              </div>
              <a [routerLink]="['/admin/cows', cow.id]" class="btn-view">
                <span>Voir</span>
                <span class="arrow">â†’</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions Rapides -->
      <div class="card actions-card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-icon">âš¡</span>
            <h2>Actions Rapides</h2>
          </div>
        </div>
        <div class="card-body">
          <button class="action-btn primary" routerLink="/admin/cows/new">
            <span class="action-icon">â•</span>
            <div class="action-text">
              <strong>Ajouter une vache</strong>
              <small>Enregistrer un nouvel animal</small>
            </div>
          </button>

          <button class="action-btn" routerLink="/admin/alerts">
            <span class="action-icon">ğŸš¨</span>
            <div class="action-text">
              <strong>GÃ©rer les alertes</strong>
              <small>{{ stats.totalAlerts }} alertes en attente</small>
            </div>
          </button>

          <button class="action-btn" routerLink="/admin/reports">
            <span class="action-icon">ğŸ“Š</span>
            <div class="action-text">
              <strong>Rapport quotidien</strong>
              <small>GÃ©nÃ©rer le rapport du jour</small>
            </div>
          </button>

          <button class="action-btn" routerLink="/admin/users/new">
            <span class="action-icon">ğŸ‘¤</span>
            <div class="action-text">
              <strong>Nouveau utilisateur</strong>
              <small>Agronome ou Ã©leveur</small>
            </div>
          </button>
        </div>
      </div>

      <!-- Ã‰tat du SystÃ¨me -->
      <div class="card system-card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-icon">ğŸ”§</span>
            <h2>Ã‰tat du SystÃ¨me</h2>
          </div>
          <span class="status-indicator online">OpÃ©rationnel</span>
        </div>
        <div class="card-body">
          <div class="system-item">
            <div class="system-info">
              <span class="system-icon">ğŸ–¥ï¸</span>
              <span class="system-name">Backend API</span>
            </div>
            <span class="system-status online">
              <span class="status-dot"></span>
              En ligne
            </span>
          </div>

          <div class="system-item">
            <div class="system-info">
              <span class="system-icon">ğŸ—„ï¸</span>
              <span class="system-name">Base de donnÃ©es</span>
            </div>
            <span class="system-status online">
              <span class="status-dot"></span>
              En ligne
            </span>
          </div>

          <div class="system-item">
            <div class="system-info">
              <span class="system-icon">ğŸ“¡</span>
              <span class="system-name">Dispositifs IoT</span>
            </div>
            <span class="system-status online">
              <span class="status-dot"></span>
              {{ stats.activeCows }} actifs
            </span>
          </div>

          <div class="system-item">
            <div class="system-info">
              <span class="system-icon">ğŸ•</span>
              <span class="system-name">DerniÃ¨re sync</span>
            </div>
            <span class="system-status">
              Il y a 5 min
            </span>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
